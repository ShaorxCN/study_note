# End-to-end encryption


**End-to-end encryption (E2EE)** is a private communication system in which only communicating users can participate. As such, no one else, including the communication system provider, telecom providers, Internet providers or malicious actors, can access the cryptographic keys needed to converse.

**端到端加密(E2EE)** 是一种私密通信系统，在该系统中只有通信的用户参与通信过程。因此，任何其他人，包括该通信系统的提供者，电信服务商，网络服务商或者其他恶意攻击者，都无法获得用户对话需要用到的加密密钥。


End-to-end encryption is intended to prevent data being read or secretly modified, other than by the true sender and recipient(s). The messages are encrypted by the sender but the third party does not have a means to decrypt them, and stores them encrypted. The recipients retrieve the encrypted data and decrypt it themselves.

端到端加密通信是为了防止通信数据被除了实际发送和接收者之外的其他人读取或者修改。这些信息在发送的时候被发送者加密(并且第三方无法解密)，存储的也是加密后的密文。接收者接受这些加密数据并且自己将其解密。

Because no third parties can decipher the data being communicated or stored, for example, companies that provide end-to-end encryption are unable to hand over texts of their customers' messages to the authorities.

因为没有第三方能够解密这些通信或者存储的数据，举个例子，哪怕是那些提供端到端加密服务的公司也无法将他们用户的文本数据上交给当局。

In 2022, the UK's Information Commissioner's Office, the government body responsible for enforcing online data standards, stated that opposition to E2EE was misinformed and the debate too unbalanced, with too little focus on benefits, since E2EE helped keep children safe online and law enforcement access to stored data on servers was "not the only way" to find abusers.

2022年，英国负责执行在线数据标准的政府部门--英国信息委员会办公室表示，反对E2EE的观点太过片面，并且争论的观点也已经失衡--其中对E2EE益处的关注太少，因为E2EE有助于保护儿童的在线安全并且直接访问服务器上存储的数据也不是执法部门定位不法者的唯一方法。

### E2EE and privacy
### E2EE和隐私
In many messaging systems, including email and many chat networks, messages pass through intermediaries and are stored by a third party, from which they are retrieved by the recipient. Even if the messages are encrypted, they are only encrypted 'in transit', and are thus accessible by the service provider, regardless of whether server-side disk encryption is used. Server-side disk encryption simply prevents unauthorized users from viewing this information. It does not prevent the company itself from viewing the information, as they have the key and can simply decrypt this data.


在很多通信系统，包括邮件和许多其他网络聊天系统中，信息的传递都会经过中间人并且存储在第三方系统中，再由接收者从第三方拉取这些信息。即使这些信息是被加密过的，但也仅仅是传输过程中加密，因此无论服务端硬盘是否加密，服务提供者都可以访问这些数据。服务端硬盘加密只是简单的防止未授权用户访问这些信息。但是无法阻止公司自己查看这些信息，因为他们拥有密钥并可以轻松的解密这些数据。

This allows the third party to provide search and other features, or to scan for illegal and unacceptable content, but also means they can be read and misused by anyone who has access to the stored messages on the third-party system, whether this is by design or via a backdoor. This can be seen as a concern in many cases where privacy is very important, such as businesses whose reputation depends on their ability to protect third party data, negotiations and communications that are important enough to have a risk of targeted 'hacking' or surveillance, and where sensitive subjects such as health, and information about minors are involved.

这也就允许第三方能够提供搜索以及一些其他的功能，或者检索一些非法以及不可接受的内容，但是这也就意味着，只要能够访问第三方系统中存储数据，就能够读取并滥用这些数据。不管是合法访问还是通过后门。这在很多隐私十分重要的场景中尤为值得关注，比如企业的声誉取决于其保护第三方数据的能力，比如足够重要的谈判和通信可能被有目的性的攻击或者监视，再比如健康以及未成年人相关的敏感信息。


It is important to note that E2EE alone does not guarantee privacy or security. For example, data may be held unencrypted on the user's own device, or be accessible via their own app, if their login is compromised.

需要注意的是，仅凭E2EE并不能保证隐私安全。例如，如果用户的登录受信息泄露 ，数据可能会未经加密地保存在用户自己的设备上，或通过用户自己的应用程序进行访问。

### Etymology of the term
### E2EE的发展由来

The term "end-to-end encryption" originally only meant that the communication is never decrypted during its transport from the sender to the receiver. For example, around 2003, E2EE has been proposed as an additional layer of encryption for GSM or TETRA, in addition to the existing radio encryption protecting the communication between the mobile device and the network infrastructure. This has been standardized by SFPG for TETRA. Note that in TETRA E2EE, the keys are generated by a Key Management Centre (KMC) or a Key Management Facility (KMF), not by the communicating users.

端到端加密最初仅仅是指通信从发送方到接收方的过程中一直加密。举个例子，大约2003年，在现有的无线电机密基础上，E2EE被提议作为GSM(全球移动通信系统)和TETRA(陆地集群无线电)的额外加密层，以此来保护移动设备和网络基础设施之间的通信安全。SFPG甚至已经为TETRA设计了相应的标准。不过要注意的是，TETRA中使用E2EE，通信密钥是由密钥管理中心(KMC)或者密钥管理设施(KMF)生成，而不是通信用户自己。

Later, around 2014, the meaning of "end-to-end encryption" started to evolve when WhatsApp encrypted a portion of its network, requiring that not only the communication stays encrypted during transport, but also that the provider of the communication service is not able to decrypt the communications either by having access to the private key, or by having the capability to undetectably inject an adversarial public key as part of a man-in-the-middle attack. This new meaning is now the widely accepted one.

再往后，大约在2014年，在WhatsApp加密了一部分网络层后，端到端加密系统的标准也得到了扩展，其要求加密不仅仅只停留在通信过程中，也要求提供通信服务的服务商无法通过访问私钥或者以类似中间人攻击的形式，替换公钥来解密通信。这也是现在被广泛接受的标准。




### Modern usage
### 现代用法

As of 2016, typical server-based communications systems do not include end-to-end encryption. These systems can only guarantee the protection of communications between clients and servers, meaning that users have to trust the third parties who are running the servers with the sensitive content. End-to-end encryption is regarded as safer because it reduces the number of parties who might be able to interfere or break the encryption. In the case of instant messaging, users may use a third-party client or plugin to implement an end-to-end encryption scheme over an otherwise non-E2EE protocol.

截至2016年，典型的服务端通信系统并不支持端到端加密。这些系统只能保证客户端到服务端的通信传输安全，这也意味着用户需要相信这些运行包含敏感信息服务的第三方。端到端加密被认为是更加安全的一种通信方式，因为他减少了能够侵入干扰或者破坏加密过程的可能参与者。在即时通信系统中，用户可以使用第三方客户端或者插件，以此在原本非E2EE加密协议的基础上实现端到端加密通信。

Some non-E2EE systems, such as Lavabit and Hushmail, have described themselves as offering "end-to-end" encryption when they did not. Other systems, such as Telegram and Google Allo, have been criticized for not enabling end-to-end encryption by default. Telegram did not enable end-to-end encryption by default on VoIP calls while users were using desktop software version, but that problem was fixed quickly. However, as of 2020, Telegram still features no end-to-end encryption by default, no end-to-end encryption for group chats, and no end-to-end encryption for its desktop clients.

部分非E2EE系统，比如Lavabit 和 Hushmail,当时他们没有提供端到端加密功能，却被宣称提供了此类服务。还有一些其他系统，比如Telegram 和 Google Allo，曾经因为没有默认开启端到端加密功能而受到批评。对于Telegram，当用户使用他的桌面客户端软件发起VoIP通话的时候，默认是不开启端到端加密功能的，不过这个问题很快得到了解决。然而，截至到2020年。Telegram仍然没有默认开启端到端加密功能。群组聊天没有实现默认端到端加密，也没有为他的桌面客户端软件提供端到端加密功能。


Some encrypted backup and file sharing services provide client-side encryption. The encryption they offer is here not referred to as end-to-end encryption, because the services are not meant for sharing messages between users. However, the term "end-to-end encryption" is sometimes incorrectly used to describe client-side encryption.

一些加密备份软件以及文件共享服务提供了客户端侧加密。他们提供的这种加密并不能称为端到端加密。因为这些服务并不是为了在用户之间共享信息。但是，有时候客户端侧加密被错误的描述为端到端加密。




## Challenges
## 面临的挑战

### Man-in-the-middle attacks
### 中间人攻击

End-to-end encryption ensures that data is transferred securely between endpoints. But, rather than try to break the encryption, an eavesdropper may impersonate a message recipient (during key exchange or by substituting their public key for the recipient's), so that messages are encrypted with a key known to the attacker. After decrypting the message, the snoop can then encrypt it with a key that they share with the actual recipient, or their public key in case of asymmetric systems, and send the message on again to avoid detection. This is known as a man-in-the-middle attack (MITM).

端到端加密确保了数据在终端之间传输的安全。但是与其尝试解密消息，黑客还可能选择在密钥交换过程中冒充收件人以获取密钥或者用他们自己的公钥替换实际收件人的，这样信息就是使用攻击者已知的密钥加密。在解密消息后，攻击者可以继续使用和实际收件人一致的密钥加密信息然后发送以避免攻击被发现。当然对于非对称机密系统，则是使用他们自己的公钥加密再发送回去。这就是所谓的中间人攻击。(MITM)


### Authentication
### 认证


Most end-to-end encryption protocols include some form of endpoint authentication specifically to prevent MITM attacks. For example, one could rely on certification authorities or a web of trust.[26] An alternative technique is to generate cryptographic hashes (fingerprints) based on the communicating users’ public keys or shared secret keys. The parties compare their fingerprints using an outside (out-of-band) communication channel that guarantees integrity and authenticity of communication (but not necessarily secrecy), before starting their conversation. If the fingerprints match, there is, in theory, no man in the middle.[1]

大部分端到端加密协议包含了某种形式的终端认证规则以此来防止中间人攻击。举个例子，可以依赖证书认证机构或者信任网络(基于已经信任的节点来确定新节点是否可信)。另一种技术是基于通信用户的公钥或共享密钥生成加密哈希（指纹）。再通信开始之前，通信双方使用其他通信方式来验证数字哈希，以此来确保通信的完整以及准确性（但不一定保证隐私性）。这样如果指纹匹配，理论上就不存在中间人攻击。

When displayed for human inspection, fingerprints usually use some form of Binary-to-text encoding. These strings are then formatted into groups of characters for readability. Some clients instead display a natural language representation of the fingerprint. As the approach consists of a one-to-one mapping between fingerprint blocks and words, there is no loss in entropy. The protocol may choose to display words in the user's native (system) language. This can, however, make cross-language comparisons prone to errors.

在某些供我们查阅指纹的场景下，指纹数据通常会以某种二进制到文本的编码形式展现。这些字符串会被格式化为字符组，以便我们阅读。一些客户端会显示指纹的自然语言(十六进制?)的表示形式。由于这种方法是指纹数据块和单词之间的一对一映射，所以不会丢失信息熵。协议可以选择以用户的母语（系统语言）显示这些文本。但是，这可能会导致跨语言比较出现错误。



In order to improve localization, some protocols have chosen to display fingerprints as base 10 strings instead of more error prone hexadecimal or natural language strings. An example of the base 10 fingerprint (called safety number in Signal and security code in WhatsApp) would be:

```
 37345  35585  86758  07668
 05805  48714  98975  19432
 47272  72741  60915  64451
```

为了提供高本地化程度，一些协议选择将指纹数据以十进制字符串的形式展示而不是更加易错十六进制或者自然语言字符串。下面是一个指纹数据以十进制展现的例子(WhatsApp中被称为安全码 Signal中则成为安全编号)

```
 37345  35585  86758  07668
 05805  48714  98975  19432
 47272  72741  60915  64451
```

Other applications such as Telegram, instead, encode fingerprints using emojis.

其他例如Telegram等应用会使用表情来编码指纹数据。

Modern messaging applications can also display fingerprints as QR codes that users can scan off each other's devices.

现代的通信应用还可以将指纹数据以二维码的形式展示，这样用户可以直接通过扫描对方的设备来读取验证。

### Endpoint security
### 终端安全

The end-to-end encryption paradigm does not directly address risks at the communications endpoints themselves. Each user's computer can still be hacked to steal their cryptographic key (to create a MITM attack) or simply read the recipients’ decrypted messages both in real time and from log files. Even the most perfectly encrypted communication pipe is only as secure as the mailbox on the other end. Major attempts to increase endpoint security have been to isolate key generation, storage and cryptographic operations to a smart card such as Google's Project Vault. However, since plaintext input and output are still visible to the host system, malware can monitor conversations in real time. A more robust approach is to isolate all sensitive data to a fully air gapped computer. PGP has been recommended by experts for this purpose. However, as Bruce Schneier points out, Stuxnet developed by US and Israel successfully jumped air gap and reached Natanz nuclear plant's network in Iran. To deal with key exfiltration with malware, one approach is to split the Trusted Computing Base behind two unidirectionally connected computers that prevent either insertion of malware, or exfiltration of sensitive data with inserted malware.

端到端加密的形式并不能直接解决通讯终端本身存在的风险。每个用户的电脑仍然可能会被黑客攻击并被窃走加密密钥(以此来进行中间人攻击)，或是通过日志文件来获取解密后的信息。甚至是实时读取解密后的信息。哪怕是最完美的加密通信管道当到达终端的时候，其安全性也和信箱没有区别。提供终端安全的主要手段是将密钥的生成，存储以及加解密操作独立出来放到一张智能卡上，比如谷歌的`Google Project Vault`.然而，只要明文的输入输出在主机上还是直接可见的，那么恶意软件还是可以实时的监控用户的对话。一种更加可靠的方式则是将所有的敏感数据都独立存放到一台外网隔离的计算机上。为此，专家们推荐使用PGP.然而，正如 Bruce Schneier 所指出的，美国和以色列开发的“Stuxnet”病毒成功地通过离线渠道进入了伊朗纳坦兹核电厂的网络。 为了避免恶意软件导致密钥泄漏、一种方法是将可信计算(安全启动 存储等)分散在两个单向连接(一般物理隔离 无法反向传输数据，且只允许低网络安全向高网络安全传输数据 这样敏感数据无法从高->低传输泄露，其他还有过滤验证等)的计算机上，以避免恶意软件感染及其导致的敏感数据泄漏。

### Backdoors
### 后门


A backdoor is usually a secret method of bypassing normal authentication or encryption in a computer system, a product, an embedded device, etc. Companies may also willingly or unwillingly introduce backdoors to their software that help subvert key negotiation or bypass encryption altogether. In 2013, information leaked by Edward Snowden showed that Skype had a backdoor which allowed Microsoft to hand over their users' messages to the NSA despite the fact that those messages were officially end-to-end encrypted.

后门通常是指在计算机系统、产品、嵌入式设备等中绕过正常身份验证或加密的秘密方法。一些公司会自愿或者被迫地在他们的软件中引入后门，以此帮助他们破坏密钥协商机制或者绕过加密过程。在2013年，Edward Snowden披露的信息显示，Skype有一个后门允许微软将其用户的信息泄漏给NSA(美国国家安全局)，尽管在公开渠道Skype宣称其使用了端到端加密。

Following terrorist attacks in San Bernardino in 2015 and Pensacola in 2019, the FBI requested backdoors to Apple's iPhone software. The company, however, refused to create a backdoor for the government, citing concern that such a tool could pose risk for its consumers’ privacy.

在2015年San Bernardino和2019年Pensacola发生恐怖袭击后，FBI（美国联邦调查局）曾要求苹果公司为其iPhone设备的软件设置后门。但苹果公司拒绝为政府创建后门，理由是担心这样的工具会对消费者的隐私造成风险。

### Compliance and regulatory requirements for content inspection

### 内容检测的合规性以及监管要求


While E2EE can offer privacy benefits that make it desirable in consumer-grade services, many businesses have to balance these benefits with their regulatory requirements. For example, many organizations are subject to mandates that require them to be able to decrypt any communication between their employees or between their employees and third parties.This might be needed for archival purposes, for inspection by Data Loss Prevention (DLP) systems, for litigation-related eDiscovery or for detection of malware and other threats in the data streams. For this reason, some enterprise-focused communications and information protection systems might implement encryption in a way that ensures all transmissions are encrypted with the encryption being terminated at their internal systems (on-premises or cloud-based) so they can have access to the information for inspection and processing.

虽然 E2EE 可以提供隐私优势，使其成为消费级服务的理想选择，但许多企业必须在这些优势与监管要求之间取得平衡。例如，许多组织都必须遵守法规要求，要求他们能够解密员工之间或员工与第三方之间的任何通信。这可能是出于存档目的、数据丢失防护 (DLP) 系统检查、诉讼相关的电子发现(证据？)或检测恶意软件和数据流中其他威胁的需要。因此，一些着重企业通信和信息保护的系统可能会实现一种加密方式，其能确保所有传输都经过加密，但在其内部系统处（内部部署或基于云的）终止加密，以便他们可以访问信息进行检查和处理。






