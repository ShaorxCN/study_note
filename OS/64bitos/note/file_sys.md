# 文件系统部分

包含内容
-  [1 部分概念说明](#c1)
-  [2 FAT32文件系统](#c2)


<div id=c1><h2>部分概念说明</h2></div>


文件是一个抽象的概念，它有组织地将多个数据块管理起来，以确保有足够的存储空间容纳数据。一个文件通常由文件信息和数据两部分组成，其中的文件信息记录着文件的使用时间、文件名、文件长度、数据扇区索引等内容，而数据区则记录着文件保存的实际数据。当文件的个数达到一定数量级后，管理文件就变成一件非常复杂的事情，如果借助文件系统来管理文件可使问题变得简单许多。


文件系统通常分为下面三个部分：

- **超级块**: 或者称为引导扇区  启动扇区。主要记录文件系统的全局信息。
- **目录项**: 目录项也会因文件系统的不同类型而千差万别，总体来说，其主要作用是为了保存目录的名字、长度、属性、数据块索引表以及相关操作时间等信息。文件在文件系统里的组织结构通常情况下与目录相同，它们都使用目录项统一进行管理，我们只需使用属性信息里的标志位便可对两者加以区分。数据块索引表记录着文件数据与数据块的线性映射关系，不同文件系统的索引方式千差万别，比如，FAT类文件系统采用类似单向链表的一维索引方式，而EXT类文件系统则采用类似页表的二维索引方式。
- **数据区**: 。文件与目录的不同最终体现在数据区，虽然两者保存的都是数据，但目录中保存的是维护目录层级关系的子目录项，这些子目录项可代表文件或子目录。目录项如此往复地逐层堆砌便形成了文件系统的树状结构。

这边区别可以参考fat12:根目录区找到想要寻找的文件 然后通过目录信息里的启示簇号去找对应fat表项目。看他是不是就这一个簇 还是记录了下一个簇号。


<div id=c2><h2>FAT32文件系统</h2></div>

<img src="./img/fat32.png">

这边还是分为引导扇区 FAT表 根目录区 以及数据区四个部分 这边也会说明下FSInfo的内容


- **引导扇区**: 和FAT12一样 还是存放文件系统相关信息.也叫引导扇区.存放在硬盘分区的的第一个扇区.下图是fat12 16 32等引导扇区的区别</br><img src="./img/fatdiff.png"></br>这边说明几个有区别的字段:
    - BPB_RsvdSecCnt :这边是记录保留扇区所占的扇区数量.fat12 默认是1.而32则是不为0即可.当然长度还是2B
    - BPB_HiddSec: 隐藏扇区数 指的是LBA寻址0扇区和文件系统引导扇区间的扇区数量.
    - BPB_RootEntCnt: 根目录可以容纳的目录项数。这边FAT32为0。是通过根目录起始簇号开始找
    - BPB_RootClus:  仅fat32有效 指示根目录的起始簇号  通常为2 数据区也是2 因此fat32文件系统的根目录位于数据区的起始簇中。
    - BPB_FSInfo: 仅fat32中有效 只是FSInfo在保留区中的起始扇区号
    - BPB_BkBootSec: 仅fat32有效 指示引导扇区在保留区域中的备份位置(扇区号)。一般为6 一般也会备份FSInfo, 其一般紧随引导扇区之后</br>由此可以推算出fat32中数据区的起始扇区号:`BPB_RsvdSecCnt+BPB_FATSz32*BPB_NumFATs`.那么簇N的起始扇区号公式就是: `((N-2)*BPB_SecPerClus)+数据区起始扇区号` 这边说明目录项等也是作为0，1表项占用。
- **FSInfo**:

